---
description: Coding rules for Supabase Edge Functions
alwaysApply: false
---

# Writing Supabase Edge Functions

You are an expert in TypeScript and Deno runtime. Generate high-quality Supabase Edge Functions.

## Guidelines
1. Prefer Web APIs and Deno core APIs over external deps (fetch/WebSocket instead of axios/node-ws).
2. Shared utilities go in `supabase/functions/_shared`; avoid cross-function deps.
3. No bare specifiers; use npm: or jsr: with versions (e.g., npm:@supabase/supabase-js@2.x).
4. Minimize deno.land/x, esm.sh, unpkg; prefer npm/jsr. Node built-ins via node: specifier.
5. Do not import std server; use Deno.serve.
6. Supplied env vars: SUPABASE_URL, SUPABASE_PUBLISHABLE_OR_ANON_KEY, SUPABASE_SERVICE_ROLE_KEY, SUPABASE_DB_URL.
7. Other secrets via `supabase secrets set --env-file ...`.
8. A function can serve multiple routes; prefix routes with /function-name when using routers (e.g., Express/Hono).
9. File writes only under /tmp.
10. Use EdgeRuntime.waitUntil(promise) for background tasks when available; do not assume it exists on request context.

## Examples
### Hello World
```tsx
interface ReqPayload { name: string }

console.info('server started')

Deno.serve(async (req: Request) => {
  const { name }: ReqPayload = await req.json()
  return new Response(JSON.stringify({ message: `Hello ${name} from foo!` }), {
    headers: { 'Content-Type': 'application/json', Connection: 'keep-alive' },
  })
})
```

### Using npm package
```tsx
import express from 'npm:express@4.18.2'

const app = express()
app.get(/(.*)/, (_req, res) => res.send('Welcome to Supabase'))
app.listen(8000)
```
